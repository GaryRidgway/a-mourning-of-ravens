const scrollDebug=mourn.debug.on&&mourn.debug.includeScroll,scrollDebugV=mourn.debug.verbose&&mourn.debug.includeScroll;function scrollInit(){scrollDebug&&dbp("scrollInit()"),createScrollZone(),scrollDebug&&mourn.trackers.anchor.childNodes.forEach((o=>{const l=document.createElement("div");l.classList.add("center-dot"),o.prepend(l);const r=document.createElement("div");r.classList.add("bounds"),o.prepend(r);const e=document.createElement("div");e.classList.add("bounds-tri"),r.prepend(e)})),setCurrentScrollStanza(mourn.trackers.startStanza,!0)}function createScrollZone(){scrollDebugV&&dbp("createScrollZone()"),mourn.scrollZoneData.container=document.createElement("div"),mourn.scrollZoneData.container.id="scroll-zone-container",mourn.config.poemContainer.append(mourn.scrollZoneData.container),mourn.scrollZoneData.el=document.createElement("div"),mourn.scrollZoneData.el.id="scroll-zone",mourn.scrollZoneData.container.append(mourn.scrollZoneData.el),mourn.scrollZoneData.buffer=document.createElement("div"),mourn.scrollZoneData.buffer.id="scroll-zone-buffer",mourn.scrollZoneData.el.append(mourn.scrollZoneData.buffer),mourn.scrollZoneData.dims={x:mourn.scrollZoneData.el.scrollWidth,y:mourn.scrollZoneData.el.scrollHeight},setScrollZone(.16*mourn.scrollZoneData.dims.x,.16*mourn.scrollZoneData.dims.y,!1),mourn.scrollZoneData.el.onscroll=function(o){scrollTick(o)}}function scrollTick(o){scrollDebugV&&dbp("scrollTick()"),setScrollZone(.16*mourn.scrollZoneData.dims.x,.16*mourn.scrollZoneData.dims.y),cascadeRender(),checkStanzaScroll(),setAnchorOffsets(null)}function setScrollZone(o,l,r=!0){if(scrollDebugV&&dbp("setScrollZone()"),mourn.scrollZoneData.prevX=mourn.scrollZoneData.el.scrollLeft,mourn.scrollZoneData.prevY=mourn.scrollZoneData.el.scrollTop,mourn.scrollZoneData.el.scrollLeft=o,mourn.scrollZoneData.el.scrollTop=l,r){const o=mourn.scrollZoneData.prevX-mourn.scrollZoneData.el.scrollLeft,l=mourn.scrollZoneData.prevY-mourn.scrollZoneData.el.scrollTop,r=(Math.abs(o)>Math.abs(l)?o:l)*mourn.trackers.scrollSpeedMultiplier;mourn.scrollZoneData.total={x:mourn.scrollZoneData.total.x+r,y:mourn.scrollZoneData.total.y+r*mourn.trackers.slope},mourn.scrollStanza.currentScrollValue+=r}}function setAnchorOffsets(o=null){const l=null!==o?o:mourn.trackers.slope;scrollDebugV&&dbp("setAnchorOffsets()");const r=mourn.trackers.anchor.getBoundingClientRect(),e=r.width/2,n=r.height/2;mourn.trackers.anchorStyle.setProperty("--left-active-offset",-1*mourn.scrollZoneData.total.x+e);const t=mourn.scrollStanza.currentScrollValue*l*-1;scrollDebug&&(dbp(""),console.log("Previous scroll offset: "+dbt(mourn.scrollStanza.currentScrollStanzaData.previousScrollOffset)),console.log("Indexed offset: "+dbt(mourn.scrollStanza.currentScrollStanzaData.indexedOffset)),console.log("Direction: "+dbt(mourn.scrollStanza.mourn.scrollStanza.direction)),console.log("Anchor bounding box height offset, or"),console.log("aBBHO: "+dbt(n)),dbp("","â”ˆ"));let a=mourn.scrollStanza.currentScrollStanzaData.previousScrollOffset*mourn.scrollStanza.direction+mourn.scrollStanza.currentScrollStanzaData.indexedOffset+n+t;scrollDebug&&(console.log("Active offset (rounded): "+dbt(a)),console.log("("+dbt(mourn.scrollStanza.currentScrollStanzaData.previousScrollOffset)+"* "+dbt(mourn.scrollStanza.direction)+") + "+dbt(mourn.scrollStanza.currentScrollStanzaData.indexedOffset)+"  + "+dbt(n)+" + "+dbt(t)+" = "+dbt(a))),mourn.scrollStanza.currentTopActiveOffset=a,mourn.trackers.anchorStyle.setProperty("--top-active-offset","calc("+mourn.scrollStanza.currentTopActiveOffset+")")}function setCurrentScrollStanza(o,l=!1,r=!1){scrollDebugV&&dbp("setCurrentScrollStanza()"),scrollDebug&&(console.log("STANZA PASSED IN"),console.log(o));const e={},n=o.dataset;e.target=o,e.slope=parseFloat(n.slope),e.scrollWidth=parseFloat(n.scrollWidth),scrollDebug&&(console.log("Stanza data created"),console.log(e));let t=0;if(l)e.previousScrollOffset=0,e.indexedOffset=0,t=mourn.config.startInTopLeft?0:e.target.getBoundingClientRect().width/2;else if(mourn.scrollStanza.currentScrollValue<=0){t=(mourn.scrollStanza.currentScrollValue+e.scrollWidth)%e.scrollWidth,e.previousScrollOffset=mourn.scrollZoneData.total.y,e.indexedOffset=parseFloat(n.topOffset)}else{t=(mourn.scrollStanza.currentScrollValue+mourn.scrollStanza.currentScrollStanzaData.scrollWidth)%mourn.scrollStanza.currentScrollStanzaData.scrollWidth,e.previousScrollOffset=-mourn.scrollZoneData.total.y,e.indexedOffset=0}mourn.scrollStanza.currentScrollValue=t,mourn.trackers.slope=parseFloat(e.slope),mourn.trackers.anchorStyle.setProperty("--slope",mourn.trackers.slope),mourn.scrollStanza.currentScrollStanzaData=e}function checkStanzaScroll(){scrollDebugV&&dbp("checkStanzaScroll()"),scrollDebug&&(console.log("Current scroll value: "+mourn.scrollStanza.currentScrollValue),console.log("Current scroll stanza width: "+mourn.scrollStanza.currentScrollStanzaData.scrollWidth),console.log("Greater: "+(mourn.scrollStanza.currentScrollValue>mourn.scrollStanza.currentScrollStanzaData.scrollWidth)),console.log("Lesser: "+(mourn.scrollStanza.currentScrollValue<0))),mourn.scrollStanza.currentScrollValue>mourn.scrollStanza.currentScrollStanzaData.scrollWidth?(setCurrentScrollStanza(mourn.scrollStanza.currentScrollStanzaData.target.nextSibling),mourn.scrollStanza.direction=1):mourn.scrollStanza.currentScrollValue<0&&(setCurrentScrollStanza(mourn.scrollStanza.currentScrollStanzaData.target.previousSibling),mourn.scrollStanza.direction=-1)}